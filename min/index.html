<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>Sir Brunoâ€™s Minnelied</title>
<meta name="viewport" content="width=device-width">
<style>
*{margin:0;padding:0}html{font-size:20px;font-family:sans-serif;background:#000}#info{position:absolute;top:0;left:0;right:0;background-color:rgba(255,255,255,0.75);cursor:pointer;padding:0.5em 2em;text-align:center}#canvas{display:block;margin:auto;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;image-rendering:pixelated}@keyframes fadein{0%{opacity:0}100%{opacity:1}}#intro{overflow:auto;position:fixed;top:0;bottom:0;left:0;right:0;text-align:center}#intro div,#intro button{margin:0.5em;padding:0.5em;background:rgba(255,255,255,0.75);animation:1s fadein both}#intro .d2{animation-delay:1.5s}#intro .d3{animation-delay:4.5s}#intro span{display:inline-block;max-width:50em}#intro button{font:inherit;border:solid medium transparent;padding:1em;cursor:pointer}#intro button:hover{border-color:#000}</style>
</head><body>
<canvas id="canvas" moz-opaque></canvas>
<div id="info"></div>
<div id="intro">
<div class="d1"><span>A.D. 1207. The knight Sir Bruno sets out to see Lady Sylvie to sing his Minnelied to her, a traditional medieval love song.</span></div>
<div class="d2"><span>But when he arrives at the castle he is not well received. Instead of being allowed to see Lady Sylvie, his sword, shield, helmet, as well as the scroll with his Minnelied are taken away, and Sir Bruno is thrown into the dungeon.</span></div>
<div class="d3"><span>Can Sir Bruno recover his possesions and find Lady Sylvie? It is up to you to help him.</span></div>
<button class="d3" id="start">Play</button>
</div>
<script>
(function(){var s,g,C,t,I;s=function(){function b(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.webkitIsFullScreen}function c(){a&&a(b())}var a;document.addEventListener("fullscreenchange",c);document.addEventListener("webkitfullscreenchange",c);document.addEventListener("mozfullscreenchange",c);document.addEventListener("msfullscreenchange",c);document.addEventListener("fullscreenerror",c);document.addEventListener("webkitfullscreenerror",
c);document.addEventListener("mozfullscreenerror",c);document.addEventListener("msfullscreenerror",c);return{is:b,enter:function(){var a;if(!b())a=document.documentElement,a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen()},exit:function(){b()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?
document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())},setUpdateHandler:function(d){a=d}}}();g=function(){function b(c,a,d,f){this.width=c;this.height=a;this.interactionMode=d;f=f||{};Object.keys(f).forEach(function(a){this[a]=f[a]}.bind(this))}b.prototype.interact=function(c,a){switch(this.interactionMode){case "text":return this.text;case "take":return c.removeThing(this),a.addThing(this),"Taken: "+this.text;default:return this.interactionMode(c,a)}};b.prototype.draw=
function(c,a,d,f,b){var e;if(this.sprite&&(e=this.animate?this.sprite+Math.floor(f/500)%this.animate:this.sprite,c.drawImage(b[e],a,d+this.height-b[e].height),!this.pattern))return;c.translate(a,d);c.fillStyle=b[this.pattern];c.fillRect(0,0,this.width,this.sprite?this.height-b[e].height:this.height);c.translate(-a,-d)};b.prototype.drawInventory=function(c,a){c.drawImage(a[this.sprite+"Inv"],3,3)};b.prototype.drawPlayer=function(c,a,d,f,b){switch(this.sprite){case "helmet":c.drawImage(b.helmetPlayer,
a+9,d);break;case "sword":f||c.drawImage(b.swordPlayer,a+5,d+49)}};return b}();C=function(){function b(){this.inventory=[]}b.prototype.addThing=function(c){this.inventory.push(c)};b.prototype.hasThing=function(c){return this.inventory.indexOf(c)>-1};b.prototype.removeThing=function(c){var a;for(a=0;a<this.inventory.length;a++)if(this.inventory[a]===c){this.inventory.splice(a,1);break}};b.prototype.hasLight=function(){var c;for(c=0;c<this.inventory.length;c++)if(this.inventory[c].light)return!0};b.prototype.moveTo=
function(c,a,d,f){this.dest=c;this.interactThing=a;if(c<this.x)this.dir=!0;else if(c>this.x)this.dir=!1;if(d)this.x=c,this.dir=f};b.prototype.walk=function(c,a){var d=c*0.08;if(Math.abs(this.x-this.dest)<=d){if(this.x=this.dest,this.interactThing)return d=this.interactThing.interact(a,this),this.interactThing=null,d}else this.x<this.dest?this.x+=d:this.x-=d};b.prototype.draw=function(c,a,d,f){var b,e;this.dir&&(c.save(),c.translate(Math.round(this.x),0),c.scale(-1,1),c.translate(-Math.round(this.x),
0));b=Math.round(this.x-15);a=a-90-4;this.x!==this.dest?(e=Math.floor(d*0.08/30*2)%2?f.person0:f.person1,Math.floor(d*0.08/30*2)%2===0&&(a-=1)):e=f.person0;c.drawImage(e,b,a);for(d=0;d<this.inventory.length;d++)this.inventory[d].drawPlayer(c,b,a,this.dir,f);this.dir&&c.restore()};b.prototype.drawInventory=function(c,a,d){var f=this.inventory.length-a,b=[];f<0&&(f=0);for(a=f;a<this.inventory.length;a++)c.save(),c.translate((a-f)*30,0),this.inventory[a].drawInventory(c,d),b.push(this.inventory[a].text),
c.restore();return b};return b}();t=function(){function b(c){this.width=c;this.things=[];this.locations=[]}b.prototype.addLocation=function(c,a){this.locations.push([c,a])};b.prototype.getLocation=function(c){return this.locations[c]};b.prototype.addThing=function(c,a,d){this.things.push({t:c,x:a,y:d})};b.prototype.removeThing=function(c){var a;for(a=0;a<this.things.length;a++)if(this.things[a].t===c){this.things.splice(a,1);break}};b.prototype.findThing=function(c,a){var d,f;for(d=this.things.length-
1;d>=0;d--)if(f=this.things[d],f.t.interactionMode&&f.x<=c&&c<=f.x+f.t.width&&a<=f.y&&f.y-f.t.height<=a)return f;return null};b.prototype.getLimit=function(c,a,d){var f;a<d?a=d:a>this.width-d&&(a=this.width-d);for(f=0;f<this.things.length;f++)this.things[f].t.blocksPath&&(a=c<this.things[f].x?Math.min(a,this.things[f].x-d):Math.max(a,this.things[f].x+this.things[f].t.width+d));return a};b.prototype.draw=function(c,a,d,f,b){var e;this.isOutside?(c.fillStyle="#aaf",c.fillRect(0,0,this.width,d-50),c.fillStyle=
"#afa",c.fillRect(0,d-50,this.width,50)):(c.fillStyle=b.bg,e=(d-10)%24,e!==0&&(e=24-e),c.translate(0,-e),c.fillRect(0,0,this.width,d-10+e),c.translate(0,e),c.fillStyle=b.floor,c.fillRect(0,d-10,this.width,10));for(e=0;e<this.things.length;e++)this.things[e].t.draw(c,this.things[e].x,d-this.things[e].y,f,b);a.draw(c,d,f,b);if(this.light)a=a.hasLight()?[a.x,Math.round(72)]:this.light,c.translate(a[0],d-a[1]),c.fillStyle=b.shadow,c.fillRect(-a[0],a[1]-d,this.width,d)};return b}();I=function(){function b(a,
d){this.canvas=a;this.info=d;this.soundOn=!0;this.hideInfo();this.ctx=a.getContext("2d",{alpha:!1});this.calcSize();this.initEvents()}var c=window.requestAnimationFrame||window.mozRequestAnimationFrame;b.prototype.setPlayer=function(a){this.player=a};b.prototype.loadSprites=function(a,d){var c=new Image,b;b=this.ctx.createRadialGradient(0,0,0,0,0,135);b.addColorStop(0,"transparent");b.addColorStop(1,"#000");this.sprites={shadow:b};c.onload=function(){Object.keys(a).forEach(function(d){var b=a[d],
g=document.createElement("canvas"),n=g.getContext("2d");g.width=b[2];g.height=b[3];b[5]&&(n.scale(-1,1),n.translate(-b[2],0));n.drawImage(c,b[0],b[1],b[2],b[3],0,0,b[2],b[3]);this.sprites[d]=b[4]?this.ctx.createPattern(g,b[4]):g}.bind(this));d()}.bind(this);c.src="data:image/png;base64,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"};
b.prototype.calcSize=function(){var a,d,b;a=Math.floor(Math.min(window.innerWidth/400,window.innerHeight/200,5));a<1&&(a=1);d=Math.floor(window.innerWidth/a);b=Math.min(Math.max(Math.floor(window.innerHeight/a),200),270);this.canvas.width=d;this.canvas.height=b;this.canvas.style.width=d*a+"px";this.canvas.style.height=b*a+"px";this.factor=a;this.buttonsX=d-52;this.inventoryY=this.inventoryX=this.buttonsY=10;this.inventoryCount=Math.floor((d-20-52)/30);this.inventoryDescs=[];this.roomX=10;this.roomY=
60;this.roomW=d-20;this.roomH=b-40-30;b=this.roomY/2*a-20;b+="px";this.info.style.paddingTop=b;this.info.style.paddingBottom=b};b.prototype.getCoordinates=function(a){return[(a.clientX-this.canvas.offsetLeft)/this.factor,(a.clientY-this.canvas.offsetTop)/this.factor]};b.prototype.getArea=function(a,d){if(a>=this.buttonsX&&d>=this.buttonsY&&d<=this.buttonsY+16)return(a-this.buttonsX)%26<=16?["buttons",Math.floor((a-this.buttonsX)/26)]:null;if(this.isOutro)return null;if(a>=this.inventoryX&&a<=this.inventoryX+
30*this.inventoryCount&&d>=this.inventoryY&&d<=this.inventoryY+30)return["inventory",Math.floor((a-this.inventoryX)/30)];if(a>=this.roomX&&a<=this.roomX+this.roomW&&d>=this.roomY&&d<=this.roomY+this.roomH)return["room"]};b.prototype.initEvents=function(){this.canvas.addEventListener("mousemove",function(a){a=this.getCoordinates(a);a=this.getArea(a[0],a[1]);switch(a&&a[0]){case "buttons":a=a[1]===0?this.soundOn?"Turn sound off":"Turn sound on":s.is()?"Exit fullscreen":"Enter fullscreen";this.setCursorTitle("pointer",
a);break;case "inventory":a=this.inventoryDescs[a[1]];this.setCursorTitle("",a?"You have: "+a:"");break;case "room":this.setCursorTitle("crosshair","");break;default:this.setCursorTitle("","")}}.bind(this));this.canvas.addEventListener("click",function(a){var d=this.getCoordinates(a),a=d[0],d=d[1],b=this.getArea(a,d);this.hideInfo();switch(b[0]){case "buttons":if(b[1]===0)this.soundOn=!this.soundOn;else s[s.is()?"exit":"enter"]();break;case "room":this.onRoomClick(a-this.roomX+this.roomStart,this.roomH+
this.roomY-d)}}.bind(this));this.info.addEventListener("click",function(){this.hideInfo()}.bind(this));window.addEventListener("resize",function(){this.calcSize()}.bind(this))};b.prototype.showInfo=function(a){this.info.textContent=a;this.info.style.display=""};b.prototype.hideInfo=function(){this.info.style.display="none"};b.prototype.setCursorTitle=function(a,b){this.canvas.style.cursor=a;this.canvas.title=b};b.prototype.setRoom=function(a,b){b=a.getLocation(b||0);this.room=a;this.player.moveTo(b[0],
null,!0,b[1]);this.calcRoomStart(!0)};b.prototype.calcRoomStart=function(a){var b;this.room.width<=this.roomW?b=-Math.floor((this.roomW-this.room.width)/2):(b=Math.floor(this.player.x/(this.roomW/2))*(this.roomW/2)-this.roomW/4,b<0?b=0:b+this.roomW>this.room.width&&(b=this.room.width-this.roomW));b=Math.round(b);a||Math.abs(this.roomStart-b)<=10?this.roomStart=b:this.roomStart+=b>this.roomStart?10:-10};b.prototype.startDraw=function(){this.isDrawing=!0;c(function(a){this.prevTime=this.startTime=a;
this.onAnimationFrame(a)}.bind(this))};b.prototype.onAnimationFrame=function(a){var b;if(this.isDrawing)this.draw(a),(b=this.player.walk(a-this.prevTime,this.room))&&this.showInfo(b),this.calcRoomStart(),this.prevTime=a,c(this.onAnimationFrame.bind(this))};b.prototype.stopDraw=function(){this.isDrawing=!1};b.prototype.fadeIn=function(a){this.isFading=!0;this.fadeStart=-1;this.fadeDir=1;this.fadeCallback=a};b.prototype.fadeOut=function(a){this.isFading=!0;this.fadeDir=this.fadeStart=-1;this.fadeCallback=
a};b.prototype.draw=function(a){this.ctx.fillStyle="#000";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);if(this.isIntro)this.drawRoom(a);else if(this.drawButtons(),this.isOutro||this.drawInventory(),this.drawRoom(a),this.isFading){if(this.fadeStart===-1)this.fadeStart=a;a-this.fadeStart>=200?(this.isFading=!1,this.fadeCallback()):(a=(a-this.fadeStart)/200,this.fadeDir===1&&(a=1-a),this.ctx.fillStyle="rgba(0,0,0,"+a+")",this.ctx.fillRect(this.roomX,this.roomY,this.roomW,this.roomH))}};
b.prototype.drawButtons=function(){this.ctx.drawImage(this.sprites[this.soundOn?"soundOn":"soundOff"],this.buttonsX,this.buttonsY);this.ctx.drawImage(this.sprites[s.is()?"exitFullscreen":"enterFullscreen"],this.buttonsX+26,this.buttonsY)};b.prototype.drawInventory=function(){this.ctx.save();this.ctx.translate(this.inventoryX,this.inventoryY);this.ctx.fillStyle="#ddd";this.ctx.fillRect(0,0,30*this.inventoryCount,30);this.inventoryDescs=this.player.drawInventory(this.ctx,this.inventoryCount,this.sprites);
this.ctx.restore()};b.prototype.drawRoom=function(a){this.ctx.save();this.ctx.beginPath();this.room.width<=this.roomW?this.ctx.rect(this.roomX+Math.floor((this.roomW-this.room.width)/2),this.roomY,this.room.width,this.roomH):this.ctx.rect(this.roomX,this.roomY,this.roomW,this.roomH);this.ctx.clip();this.ctx.translate(this.roomX-this.roomStart,this.roomY);this.room.draw(this.ctx,this.player,this.roomH,a,this.sprites);this.ctx.restore()};b.prototype.onRoomClick=function(a,b){var c,g;this.isDrawing&&
!this.isFading&&((c=this.room.findThing(a,b))&&this.player.x+22.5>=c.x&&this.player.x-22.5<=c.x+c.t.width?((g=c.t.interact(this.room,this.player))&&this.showInfo(g),c.t.alwaysWalk&&this.player.moveTo(this.room.getLimit(this.player.x,a,15))):(a=this.room.getLimit(this.player.x,a,15),this.player.moveTo(a,c&&a+22.5>=c.x&&a-22.5<=c.x+c.t.width&&c.t)))};return b}();(function(){function b(a,b){d.fadeOut(function(){d.setRoom(a,b);d.fadeIn(function(){})})}var c=document.getElementById("intro"),a=document.getElementById("start"),
d=new I(document.getElementById("canvas"),document.getElementById("info")),f,n,e,h,k,v,r,o,s,D,E,l,z,A,F,G,H,B,j,q,x,p,i,w,y,u,J,m,K;D=new g(16,12,"take",{text:"A key",sprite:"key"});E=new g(16,12,"take",{text:"A second key",sprite:"key"});l=new g(12,40,"take",{text:"A torch",sprite:"torch",animate:2,light:!0});z=new g(16,16,"take",{text:"Your helmet",sprite:"helmet"});A=new g(24,24,"take",{text:"Your sword",sprite:"sword"});F=new g(24,24,"take",{text:"Your shield",sprite:"shield"});G=new g(24,7,
"take",{text:"The scroll with your Minnelied",sprite:"scroll"});H=new g(16,9,"take",{text:"A herring",sprite:"herring"});B=new g(16,10,"take",{text:"A bone with some meat",sprite:"bone"});j=new g(30,5,"",{pattern:"wood"});q=new g(25,50,"",{sprite:"window"});x=new g(4,4,"",{sprite:"doorKnob"});p=new g(8,17,"",{sprite:"holder"});i=new g(24,195,function(){b(e,2);return"You climb up the ladder."},{pattern:"ladder"});w=new g(22,195,function(a,b){if(this.state)return"The door is open.";return b.hasThing(D)?
(this.state=!0,this.blocksPath=!1,this.pattern="door1",this.width=52,"You unlock the door with the key."):"The door is locked."},{pattern:"door0",alwaysWalk:!0,blocksPath:!0});f=new t(680);f.light=[200,95];f.addLocation(150);f.addLocation(512,!0);f.addThing(D,5,20);f.addThing(l,200,115);f.addThing(p,202,92);f.addThing(w,300,200);f.addThing(i,500,200);f.addThing(F,650,34);l=new g(22,204,function(){b(e);return"You go upstairs."},{sprite:"stairsUpLeftBottom",pattern:"stairsUpLeft"});n=new t(500);n.light=
[9,200];n.addLocation(37);n.addThing(l,0,204);n.addThing(j,50,75);n.addThing(j,150,75);n.addThing(j,250,75);n.addThing(j,350,75);n.addThing(j,450,75);n.addThing(H,57,84);n.addThing(A,253,97);n.addThing(B,457,85);l=new g(34,200,function(){b(n);return"You go downstairs."},{sprite:"stairsDownLeftBottom",pattern:"stairsDownLeft"});i=new g(48,120,function(a,c){return c.hasThing(E)?(b(h),"You unlock the door with the second key and enter the room."):"The door is locked and your key does not fit."},{pattern:"wood",
alwaysWalk:!0});w=new g(24,21,function(){b(f,1);return"You climb down the ladder."},{sprite:"ladderTop"});y=new g(22,204,function(){b(k,1);return"You go upstairs."},{sprite:"stairsUpRightBottom",pattern:"stairsUpRight"});u=new g(12,40,"",{sprite:"torch",animate:2});J=new g(80,5,"",{pattern:"wood"});m=new g(12,14,"",{sprite:"flame",animate:2});K=new g(100,60,"",{pattern:"stone"});e=new t(680);e.addLocation(45);e.addLocation(270);e.addLocation(512);e.addLocation(643,!0);e.addThing(l,-4,200);e.addThing(u,
50,115);e.addThing(p,52,92);e.addThing(K,90,70);e.addThing(J,100,19);e.addThing(m,100,30);e.addThing(m,105,35);e.addThing(m,110,32);e.addThing(m,116,38);e.addThing(m,121,29);e.addThing(m,124,45);e.addThing(m,127,36);e.addThing(m,130,31);e.addThing(m,135,38);e.addThing(m,137,44);e.addThing(m,140,30);e.addThing(m,146,36);e.addThing(m,149,45);e.addThing(m,150,32);e.addThing(m,155,39);e.addThing(m,161,29);e.addThing(m,167,35);e.addThing(m,170,31);e.addThing(i,246,130);e.addThing(x,285,75);e.addThing(u,
330,115);e.addThing(p,332,92);e.addThing(u,400,115);e.addThing(p,402,92);e.addThing(u,470,115);e.addThing(p,472,92);e.addThing(w,499,21);e.addThing(u,540,115);e.addThing(p,542,92);e.addThing(u,610,115);e.addThing(p,612,92);e.addThing(y,658,204);p=new g(48,120,function(){b(e,1);return"You leave the armory."},{pattern:"wood"});i=new g(16,16,"text",{text:"This is not your helmet, so you leave it there.",sprite:"helmet"});l=new g(24,24,"text",{text:"This is not your sword, so you leave it there.",sprite:"sword"});
h=new t(440);h.light=[220,200];h.addLocation(220);h.addThing(j,20,65);h.addThing(i,20,81);h.addThing(G,25,72);h.addThing(j,20,100);h.addThing(i,35,116);h.addThing(l,20,122);h.addThing(j,70,65);h.addThing(l,70,87);h.addThing(i,85,81);h.addThing(j,70,100);h.addThing(i,70,116);h.addThing(i,85,116);h.addThing(j,120,65);h.addThing(i,120,81);h.addThing(i,135,81);h.addThing(j,120,100);h.addThing(l,120,122);h.addThing(i,135,116);h.addThing(p,196,130);h.addThing(x,235,75);h.addThing(j,290,65);h.addThing(i,
290,81);h.addThing(i,305,81);h.addThing(j,290,100);h.addThing(i,305,116);h.addThing(l,290,122);h.addThing(j,340,65);h.addThing(l,340,87);h.addThing(i,355,81);h.addThing(j,340,100);h.addThing(i,340,116);h.addThing(i,355,116);h.addThing(j,390,65);h.addThing(i,390,81);h.addThing(i,405,81);h.addThing(j,390,100);h.addThing(l,390,122);h.addThing(i,405,116);j=new g(22,204,function(){b(r,1);return"You go upstairs."},{sprite:"stairsUpLeftBottom",pattern:"stairsUpLeft"});p=new g(34,200,function(){b(e,3);return"You go downstairs."},
{sprite:"stairsDownRightBottom",pattern:"stairsDownRight"});l=new g(45,45,function(){if(this.state)return this.state=!1,this.width=45,"You put the tapestry back.";this.state=!0;this.width=5;return"You find a hiding place behind the tapestry!"},{pattern:"tapestry"});i=new g(45,45,"text",{pattern:"tapestry",text:"This is a nice tapestry, but there is nothing special about this one.",alwaysWalk:!0});y=new g(41,4,"",{pattern:"stone"});u=new g(4,41,"",{pattern:"stone"});w=new g(33,33,"",{pattern:"wood"});
k=new t(700);k.addLocation(37);k.addLocation(655,!0);k.addThing(j,0,204);k.addThing(q,50,130);k.addThing(i,118,130);k.addThing(q,205,130);k.addThing(i,273,130);k.addThing(q,350,130);k.addThing(w,424,124);k.addThing(z,428,106);k.addThing(y,420,128);k.addThing(y,420,91);k.addThing(u,420,128);k.addThing(u,457,128);k.addThing(l,418,130);k.addThing(q,495,130);k.addThing(i,563,130);k.addThing(q,640,130);k.addThing(p,670,200);j=new g(24,195,function(){b(r);return"You climb up the ladder."},{pattern:"ladder"});
v=new t(200);v.addLocation(32);v.addThing(j,20,200);v.addThing(q,120,130);v.addThing(E,170,20);p=new g(24,21,function(){b(v);return"You climb down the ladder."},{sprite:"ladderTop"});l=new g(34,200,function(){b(k);return"You go downstairs."},{sprite:"stairsDownRightBottom",pattern:"stairsDownRight"});i=new g(30,16,function(a,b){var c="The dog looks small but vicious and won\u2019t let you pass.";if(this.state)return"The dog is eating and ignores you.";if(b.hasThing(B))return this.state=!0,this.blocksPath=
!1,this.sprite="dog1",b.removeThing(B),"You throw the bone to the dog, and it starts eating.";b.hasThing(H)&&(c+=" (The dog doesn\u2019t like fish.)");return c},{sprite:"dog0",blocksPath:!0,alwaysWalk:!0});j=new g(24,90,function(a,c){if(!c.hasThing(A))return"Lady Sylvie: \u201cI don\u2019t believe you are a knight if you don\u2019t carry a sword!\u201d";if(!c.hasThing(F))return"Lady Sylvie: \u201cI don\u2019t believe you are a knight if you don\u2019t carry a shield!\u201d";if(!c.hasThing(z))return"Lady Sylvie: \u201cI don\u2019t believe you are a knight if you don\u2019t wear a helmet!\u201d";
if(!c.hasThing(G))return"Lady Sylvie: \u201cYou look to nervous to sing your Minnelied without the scroll with your notes to remember it!\u201d";b(s);d.isOutro=!0;return"You successfully helped Sir Bruno on his mission! Well done and thank you for playing!"},{sprite:"lady",blocksPath:!0});r=new t(560);r.addLocation(32);r.addLocation(335,!0);r.addThing(p,19,21);r.addThing(q,50,130);r.addThing(i,150,21);r.addThing(q,170,130);r.addThing(l,350,200);r.addThing(q,290,130);r.addThing(j,510,95);r.addThing(q,
410,130);r.addThing(q,530,130);q=new g(45,132,"",{pattern:"bg"});p=new g(90,84,"",{pattern:"bg"});l=new g(60,75,"",{pattern:"wood"});i=new g(15,8,"",{pattern:"stone"});o=new t(250);o.isOutside=!0;o.addLocation(25);o.addThing(q,35,172);o.addThing(i,35,180);o.addThing(i,65,180);o.addThing(p,80,124);o.addThing(l,95,115);o.addThing(x,97,113);o.addThing(x,149,113);o.addThing(i,80,132);o.addThing(i,117,132);o.addThing(i,155,132);o.addThing(q,170,172);o.addThing(i,170,180);o.addThing(i,200,180);s=new t(90);
s.addLocation(25);s.addThing(j,53,95);d.loadSprites({bg:[0,0,24,24,"repeat"],floor:[71,33,7,3,"repeat"],wood:[48,12,7,3,"repeat"],stone:[55,12,7,3,"repeat"],person0:[0,24,30,90],person1:[0,114,30,90],keyInv:[24,0,24,24],key:[48,0,16,12],window:[30,24,25,50],torch0:[30,74,12,40],torch1:[42,74,12,40],torchInv:[54,142,24,24],flame0:[30,74,12,14],flame1:[42,74,12,14],helmetInv:[64,0,24,24],helmetPlayer:[48,15,12,9],helmet:[55,24,16,16],swordInv:[64,40,24,24],swordPlayer:[55,40,10,22],sword:[64,40,24,
24],shieldInv:[64,64,24,24],shield:[64,64,24,24],tapestry:[71,24,9,9,"repeat"],ladder:[64,88,24,16,"repeat"],ladderTop:[63,88,26,26],enterFullscreen:[88,0,16,16],exitFullscreen:[88,16,16,16],soundOn:[88,32,16,16],soundOff:[88,48,16,16],lady:[30,114,24,90],dog0:[54,114,30,16],dog1:[54,130,30,12],scroll:[54,190,24,7],scrollInv:[54,166,24,24],herring:[88,64,16,9],herringInv:[78,142,24,24],bone:[88,73,16,10],boneInv:[78,161,24,24],stairsUpRightBottom:[90,114,22,28],stairsUpRight:[90,92,22,22,"repeat"],
stairsUpLeftBottom:[90,114,22,28,"",!0],stairsUpLeft:[90,92,22,22,"repeat",!0],stairsDownRightBottom:[78,194,34,10],stairsDownRight:[78,185,34,9,"repeat"],stairsDownLeftBottom:[78,194,34,10,"",!0],stairsDownLeft:[78,185,34,9,"repeat",!0],door0:[54,197,10,5,"repeat"],door1:[64,197,10,5,"repeat"],doorKnob:[88,83,4,4],holder:[104,73,8,17]},function(){var b=new C;b.addThing(A);b.addThing(z);d.setPlayer(b);d.setRoom(o);d.isIntro=!0;d.startDraw();b.moveTo(125);a.addEventListener("click",function(){c.style.display=
"none";d.isIntro=!1;d.setPlayer(new C);d.setRoom(f)})})})()})();
</script>
</body></html>