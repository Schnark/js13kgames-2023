<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>Something with Medieval Castle</title>
<meta name="viewport" content="width=device-width">
<style>
*{margin:0;padding:0}html{font-family:sans-serif}#info{position:absolute;top:0;left:0;right:0;background-color:rgba(255,255,255,0.75);cursor:pointer;padding:0.5em 2em;text-align:center}#canvas{display:block;margin:auto;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges}</style>
</head><body>
<canvas id="canvas"></canvas>
<div id="info"></div>
<script>
(function(){var f,h,k,m;f=function(){function d(b,a,c,e){this.width=b;this.height=a;this.interactionMode=c;this.text=e}d.prototype.getText=function(){var b;if(!Array.isArray(this.text))return this.text;b=this.text.shift();this.text.push(b);return b};d.prototype.interact=function(b,a){switch(this.interactionMode){case "text":return this.getText();case "toggle":return this.state=!this.state,this.getText();case "take":return b.removeThing(this),a.addThing(this),"Taken: "+this.getText()}};d.prototype.draw=
function(b,a,c,e,d){if(this.sprite)e=Array.isArray(this.sprite)?this.sprite[Math.floor(e/500)%this.sprite.length]:this.sprite,b.drawImage(d[e],a,c);else{b.fillStyle="#f00";if(this.state)b.fillStyle="#0f0";b.fillRect(a,c,this.width,this.height)}};d.prototype.drawInventory=function(b,a){this.sprite?b.drawImage(a[this.sprite+"Inv"],3,3):(b.fillStyle="#f00",b.fillRect(3,3,24,24))};return d}();h=function(){function d(){this.inventory=[]}d.prototype.addThing=function(b){this.inventory.push(b)};d.prototype.hasThing=
function(b){return this.inventory.indexOf(b)>-1};d.prototype.moveTo=function(b,a,c,e){this.dest=b;this.interactThing=a;if(b<this.x)this.dir=!0;else if(b>this.x)this.dir=!1;if(c)this.x=b,this.dir=e};d.prototype.walk=function(b,a){var c=b*0.1;if(Math.abs(this.x-this.dest)<=c){if(this.x=this.dest,this.interactThing)return c=this.interactThing.interact(a,this),this.interactThing=null,c}else this.x<this.dest?this.x+=c:this.x-=c};d.prototype.draw=function(b,a,c,e){this.dir&&(b.translate(this.x,0),b.scale(-1,
1),b.translate(-this.x,0));b.drawImage(e.person,Math.round(this.x-15),a-90-2)};d.prototype.drawInventory=function(b,a,c){var e=this.inventory.length-a,d=[];e<0&&(e=0);for(a=e;a<this.inventory.length;a++)b.save(),b.translate((a-e)*30,0),this.inventory[a].drawInventory(b,c),d.push(this.inventory[a].getText()),b.restore();return d};return d}();k=function(){function d(b){this.width=b;this.things=[];this.locations=[]}d.prototype.addLocation=function(b,a){this.locations.push([b,a])};d.prototype.getLocation=
function(b){return this.locations[b]};d.prototype.addThing=function(b,a,c){this.things.push({t:b,x:a,y:c})};d.prototype.removeThing=function(b){var a;for(a=0;a<this.things.length;a++)if(this.things[a].t===b){this.things.splice(a,1);break}};d.prototype.findThing=function(b,a){var c,e;for(c=this.things.length-1;c>=0;c--)if(e=this.things[c],e.t.interactionMode&&e.x<=b&&b<=e.x+e.t.width&&a<=e.y&&e.y-e.t.height<=a)return e;return null};d.prototype.getLimit=function(b,a,c){var e;a<c?a=c:a>this.width-c&&
(a=this.width-c);for(e=0;e<this.things.length;e++)this.things[e].t.blocksPath&&(a=b<this.things[e].x?Math.min(a,this.things[e].x-c):Math.max(a,this.things[e].x+this.things[e].t.width+c));return a};d.prototype.draw=function(b,a,c,e,d){var g;b.fillStyle=d.bg;b.fillRect(0,0,this.width,c-5);b.fillStyle=d.floor;b.fillRect(0,c-5,this.width,5);for(g=0;g<this.things.length;g++)this.things[g].t.draw(b,this.things[g].x,c-this.things[g].y,e,d);a.draw(b,c,e,d)};return d}();m=function(){function d(a,c){this.canvas=
a;this.info=c;this.hideInfo();this.ctx=a.getContext("2d");this.player=new h;this.calcSize();this.initEvents()}var b=window.requestAnimationFrame||window.mozRequestAnimationFrame;d.prototype.loadSprites=function(a,c){var b=new Image;this.sprites={};b.onload=function(){Object.keys(a).forEach(function(c){var d=a[c],f=document.createElement("canvas"),j=f.getContext("2d");f.width=d[2];f.height=d[3];j.drawImage(b,d[0],d[1],d[2],d[3],0,0,d[2],d[3]);this.sprites[c]=d[4]?this.ctx.createPattern(f,d[4]):f}.bind(this));
c()}.bind(this);b.src="data:image/png;base64,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"};
d.prototype.calcSize=function(){var a,c,b;a=Math.floor(Math.min(window.innerWidth/400,window.innerHeight/200,5));a<1&&(a=1);c=Math.floor(window.innerWidth/a);b=Math.min(Math.max(Math.floor(window.innerHeight/a),200),270);this.canvas.width=c;this.canvas.height=b;this.canvas.style.width=c*a+"px";this.canvas.style.height=b*a+"px";this.factor=a;this.inventoryY=this.inventoryX=10;this.inventoryCount=Math.floor((c-20)/30);this.inventoryDescs=[];this.roomX=10;this.roomY=60;this.roomW=c-20;this.roomH=b-40-
30};d.prototype.getCoordinates=function(a){return[(a.clientX-this.canvas.offsetLeft)/this.factor,(a.clientY-this.canvas.offsetTop)/this.factor]};d.prototype.initEvents=function(){this.canvas.addEventListener("mousemove",function(a){var c=this.getCoordinates(a),a=c[0],c=c[1];a>=this.inventoryX&&a<=this.inventoryX+30*this.inventoryCount&&c>=this.inventoryY&&c<=this.inventoryY+30?(a=this.inventoryDescs[Math.floor((a-this.inventoryX)/30)],this.setCursorTitle("",a?"You have: "+a:"")):a>=this.roomX&&a<=
this.roomX+this.roomW&&c>=this.roomY&&c<=this.roomY+this.roomH?this.setCursorTitle("crosshair",""):this.setCursorTitle("","")}.bind(this));this.canvas.addEventListener("click",function(a){var c=this.getCoordinates(a),a=c[0],c=c[1];this.hideInfo();if(a>=this.roomX&&a<=this.roomX+this.roomW&&c>=this.roomY&&c<=this.roomY+this.roomH)this.onRoomClick(a-this.roomX+this.roomStart,this.roomH+this.roomY-c)}.bind(this));this.info.addEventListener("click",function(){this.hideInfo()}.bind(this));window.addEventListener("resize",
function(){this.calcSize()}.bind(this))};d.prototype.showInfo=function(a){this.info.textContent=a;this.info.style.display=""};d.prototype.hideInfo=function(){this.info.style.display="none"};d.prototype.setCursorTitle=function(a,c){this.canvas.style.cursor=a;this.canvas.title=c};d.prototype.setRoom=function(a,c){c=a.getLocation(c||0);this.room=a;this.player.moveTo(c[0],null,!0,c[1]);this.calcRoomStart(!0)};d.prototype.calcRoomStart=function(a){var c;this.room.width<=this.roomW?c=-Math.floor((this.roomW-
this.room.width)/2):(c=Math.floor(this.player.x/(this.roomW/2))*(this.roomW/2)-this.roomW/4,c<0?c=0:c+this.roomW>this.room.width&&(c=this.room.width-this.roomW));c=Math.round(c);a||Math.abs(this.roomStart-c)<=10?this.roomStart=c:this.roomStart+=c>this.roomStart?10:-10};d.prototype.startDraw=function(){this.isDrawing=!0;b(function(a){this.prevTime=this.startTime=a;this.onAnimationFrame(a)}.bind(this))};d.prototype.onAnimationFrame=function(a){var c;if(this.isDrawing)this.draw(a),(c=this.player.walk(a-
this.prevTime,this.room))&&this.showInfo(c),this.calcRoomStart(),this.prevTime=a,b(this.onAnimationFrame.bind(this))};d.prototype.stopDraw=function(){this.isDrawing=!1};d.prototype.fadeIn=function(a){this.isFading=!0;this.fadeStart=-1;this.fadeDir=1;this.fadeCallback=a};d.prototype.fadeOut=function(a){this.isFading=!0;this.fadeDir=this.fadeStart=-1;this.fadeCallback=a};d.prototype.draw=function(a){this.ctx.fillStyle="#000";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.drawInventory();
this.drawRoom(a);if(this.isFading){if(this.fadeStart===-1)this.fadeStart=a;a-this.fadeStart>=200?(this.isFading=!1,this.fadeCallback()):(a=(a-this.fadeStart)/200,this.fadeDir===1&&(a=1-a),this.ctx.fillStyle="rgba(0,0,0,"+a+")",this.ctx.fillRect(this.roomX,this.roomY,this.roomW,this.roomH))}};d.prototype.drawInventory=function(){this.ctx.save();this.ctx.translate(this.inventoryX,this.inventoryY);this.ctx.fillStyle="#ddd";this.ctx.fillRect(0,0,30*this.inventoryCount,30);this.inventoryDescs=this.player.drawInventory(this.ctx,
this.inventoryCount,this.sprites);this.ctx.restore()};d.prototype.drawRoom=function(a){this.ctx.save();this.ctx.beginPath();this.ctx.rect(this.roomX,this.roomY,this.roomW,this.roomH);this.ctx.clip();this.ctx.translate(this.roomX-this.roomStart,this.roomY);this.room.draw(this.ctx,this.player,this.roomH,a,this.sprites);this.ctx.restore()};d.prototype.onRoomClick=function(a,c){var b;this.isDrawing&&!this.isFading&&((b=this.room.findThing(a,c))&&this.player.x+22.5>=b.x&&this.player.x-22.5<=b.x+b.t.width?
(b=b.t.interact(this.room,this.player))&&this.showInfo(b):this.player.moveTo(this.room.getLimit(this.player.x,a,15),b&&b.t))};return d}();(function(){var d=new m(document.getElementById("canvas"),document.getElementById("info")),b=new k(750),a=new k(750),c=new f(16,12,"take","A key"),e=new f(25,50),i=new f(12,40),g=new f(50,50,"toggle",["Green","Red"]),l=new f(20,200,"special"),j=new f(20,200,"special","You go upstairs."),h=new f(20,200,"special","You go downstairs."),n=new f(20,200,"text","You reach the exit and win!");
c.sprite="key";e.sprite="window";i.sprite=["torch0","torch1"];l.blocksPath=!0;l.interact=function(a,b){if(this.state)return"The door is open.";return b.hasThing(c)?(this.state=!0,this.blocksPath=!1,"You unlock the door with the key."):"The door is locked."};j.interact=function(){d.fadeOut(function(){d.setRoom(a);d.fadeIn(function(){})});return this.getText()};h.interact=function(){d.fadeOut(function(){d.setRoom(b,1);d.fadeIn(function(){})});return this.getText()};b.addLocation(50);b.addLocation(730,
!0);b.addThing(c,5,15);b.addThing(g,100,110);b.addThing(i,200,110);b.addThing(l,350,200);b.addThing(i,500,110);b.addThing(i,600,110);b.addThing(i,700,110);b.addThing(j,730,200);a.addLocation(730,!0);a.addThing(h,730,200);a.addThing(e,30,125);a.addThing(e,130,125);a.addThing(e,230,125);a.addThing(e,330,125);a.addThing(e,430,125);a.addThing(e,530,125);a.addThing(e,630,125);a.addThing(n,0,200);d.setRoom(b);d.loadSprites({bg:[0,0,24,24,"repeat"],floor:[48,12,7,3,"repeat"],person:[0,24,30,90],keyInv:[24,
0,24,24],key:[48,0,16,12],window:[30,24,25,50],torch0:[30,74,12,40],torch1:[42,74,12,40]},function(){d.startDraw()})})()})();
</script>
</body></html>