<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>Something with Medieval Castle</title>
<meta name="viewport" content="width=device-width">
<style>
#info{position:absolute;top:0;left:0;right:0;background-color:rgba(255,255,255,0.75)}</style>
</head><body>
<canvas id="canvas" width="500" height="150"></canvas>
<div id="info"></div>
<script>
(function(){var g,f,i,j;g=function(){function a(a,c,b,d){this.width=a;this.height=c;this.interactionMode=b;this.text=d}a.prototype.getText=function(){var a;if(!Array.isArray(this.text))return this.text;a=this.text.shift();this.text.push(a);return a};a.prototype.interact=function(a,c){switch(this.interactionMode){case "text":return this.getText();case "toggle":return this.state=!this.state,this.getText();case "take":return a.removeThing(this),c.addThing(this),"Taken: "+this.getText()}};a.prototype.draw=
function(a,c,b){a.fillStyle="#f00";if(this.state)a.fillStyle="#0f0";a.fillRect(c,b,this.width,this.height)};return a}();f=function(){function a(){this.dest=this.x=a.width/2;this.inventory=[]}a.width=30;a.height=100;a.speed=0.1;a.prototype.addThing=function(a){this.inventory.push(a)};a.prototype.hasThing=function(a){return this.inventory.indexOf(a)>-1};a.prototype.moveTo=function(a,c,b){this.dest=a;this.interactThing=c;if(b)this.x=a};a.prototype.walk=function(e,c){var b=e*a.speed;if(Math.abs(this.x-
this.dest)<=b){if(this.x=this.dest,this.interactThing)return b=this.interactThing.interact(c,this),this.interactThing=null,b}else this.x<this.dest?this.x+=b:this.x-=b};a.prototype.draw=function(e,c){e.fillStyle="#00f";e.fillRect(this.x-a.width/2,c-a.height,a.width,a.height)};return a}();i=function(){function a(a){this.width=a;this.things=[]}a.prototype.addThing=function(a,c,b){this.things.push({t:a,x:c,y:b})};a.prototype.removeThing=function(a){var c;for(c=0;c<this.things.length;c++)if(this.things[c].t===
a){this.things.splice(c,1);break}};a.prototype.findThing=function(a,c){var b,d;for(b=this.things.length-1;b>=0;b--)if(d=this.things[b],d.t.interactionMode&&d.x<=a&&a<=d.x+d.t.width&&c<=d.y&&d.y-d.t.height<=c)return d;return null};a.prototype.getLimit=function(a,c,b){var d;c<b?c=b:c>this.width-b&&(c=this.width-b);for(d=0;d<this.things.length;d++)this.things[d].t.blocksPath&&(c=a<this.things[d].x?Math.min(c,this.things[d].x-b):Math.max(c,this.things[d].x+this.things[d].t.width+b));return c};a.prototype.draw=
function(a,c,b){var d;a.fillStyle="#aaa";a.fillRect(0,0,this.width,b);for(d=0;d<this.things.length;d++)this.things[d].t.draw(a,this.things[d].x,b-this.things[d].y);c.draw(a,b)};return a}();j=function(){function a(a,b){this.canvas=a;this.info=b;this.hideInfo();this.ctx=a.getContext("2d");this.roomY=this.roomX=0;this.roomW=a.width;this.roomH=a.height;this.initEvents()}var e=window.requestAnimationFrame||window.mozRequestAnimationFrame;a.prototype.initEvents=function(){this.canvas.addEventListener("click",
function(a){var b=a.clientX-this.canvas.offsetLeft,a=a.clientY-this.canvas.offsetTop;this.hideInfo();if(b>=this.roomX&&b<=this.roomX+this.roomW&&a>=this.roomY&&a<=this.roomY+this.roomH)this.onRoomClick(b-this.roomX+this.roomStart,this.roomH+this.roomY-a)}.bind(this));this.info.addEventListener("click",function(){this.hideInfo()}.bind(this))};a.prototype.showInfo=function(a){this.info.textContent=a;this.info.style.display=""};a.prototype.hideInfo=function(){this.info.style.display="none"};a.prototype.setPlayer=
function(a){this.player=a;a.moveTo(f.width/2,null,!0)};a.prototype.setRoom=function(a){this.room=a;this.calcRoomStart()};a.prototype.calcRoomStart=function(){if(this.room.width<=this.roomW)this.roomStart=-Math.floor((this.roomW-this.room.width)/2);else if(this.roomStart=Math.floor(this.player.x/(0.75*this.roomW))*0.75*this.roomW,this.roomStart+this.roomW>this.room.width)this.roomStart=this.room.width-this.roomW};a.prototype.startDraw=function(){this.isDrawing=!0;e(function(a){this.prevTime=this.startTime=
a;this.onAnimationFrame(a)}.bind(this))};a.prototype.onAnimationFrame=function(a){var b;if(this.isDrawing)this.draw(),(b=this.player.walk(a-this.prevTime,this.room))&&this.showInfo(b),this.calcRoomStart(),this.prevTime=a,e(this.onAnimationFrame.bind(this))};a.prototype.stopDraw=function(){this.isDrawing=!1};a.prototype.draw=function(){this.drawRoom()};a.prototype.drawRoom=function(){this.ctx.save();this.ctx.beginPath();this.ctx.rect(this.roomX,this.roomY,this.roomW,this.roomH);this.ctx.clip();this.ctx.translate(this.roomX-
this.roomStart,this.roomY);this.room.draw(this.ctx,this.player,this.roomH);this.ctx.restore()};a.prototype.onRoomClick=function(a,b){var d;this.isDrawing&&((d=this.room.findThing(a,b))&&this.player.x+f.width*0.75>=d.x&&this.player.x-f.width*0.75<=d.x+d.t.width?(d=d.t.interact(this.room,this.player))&&this.showInfo(d):this.player.moveTo(this.room.getLimit(this.player.x,a,f.width/2),d&&d.t))};return a}();(function(){var a=new j(document.getElementById("canvas"),document.getElementById("info")),e=new f,
c=new i(750),b=new g(20,20,"take","A key"),d=new g(50,50,"toggle",["Green","Red"]),h=new g(20,200,"special"),k=new g(20,200,"text","You reach the exit and win!");h.blocksPath=!0;h.interact=function(a,c){if(this.state)return"The door is open.";return c.hasThing(b)?(this.state=!0,this.blocksPath=!1,"You unlock the door with the key."):"The door is locked."};c.addThing(b,5,20);c.addThing(d,100,110);c.addThing(h,350,200);c.addThing(k,730,200);a.setPlayer(e);a.setRoom(c);a.startDraw()})()})();
</script>
</body></html>